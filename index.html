<!DOCTYPE html>
<html>
<head>

	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	<script src="//unpkg.com/mithril/mithril.js"></script>
	<link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
	<link rel="stylesheet" href="style.css"  type="text/css"/>
	<link rel="stylesheet" href="menu.css"  type="text/css"/>
	<link rel="stylesheet" href="common.css"  type="text/css"/>


	<link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans"/>

	<script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>



</head>
<body>
	<div id="afdmenu" class="menu"></div>
	<div class="mainafd">
	<div id="wikiintro"></div>
	<div id="leafletmap"></div>
</div>


	<script>

	//Declaration of useful variables for the application



	var root = document.body;

	//request url for wikipedia component




	//"https://en.wikipedia.org/w/api.php?action=parse&format=json&prop=text&section=0&page=Agadir&callback=?&origin=*";

	//variable for request
	var Data = {
		wiki: {
			list: [],
			fetch: function() {
				m.jsonp({
					url: "https://en.wikipedia.org/w/api.php?action=parse&format=json&prop=text&section=0&page=Agadir&callback=?&origin=*",
				})
				.then(function(data) {
					console.log(data);
						console.log(text)
						var text = data.parse.text["*"].split("table");
						var pText = "<table"+text[1]+"table>";
					
				        Data.wiki.conten = pText
				        
				    
    			})
				.catch(function(e) {
					Data.wiki.error = e.message
					console.log("Error")
				})
			}
		}
	}


	//Declaration of components

	//Menu component

	var Menuafd = {
		view: function(vnode){
			return m("ul",
				[
				m("li", 
					m("a", {class: "active", href:"",id:'home'}, 
						m("i.fa.fa-home.w3-xlarge")
						)
					),
				m("li", 
					m("a",{href:'Country_dashboard.html',id:"Country_Dashboard"}, 
						"Country Dashboard "
						)
					),
				m("li", 
					m("a",{href:'Glance.html',id:'Glance'}, 
						"At a Glance "
						)
					),
				m("li", 
					m("a",{href:'inequalityDashboard.html',id:'Inequality'}, 
						"Inégalités"
						)
					),
				m("li", 
					m("a", {href:'/dataviz/local/Country_dashboard_local.html', id:'local'}, 
						"Cartes DHS"
						)
					),
				m("li", {class:"dropdown"},
					[
					m("a", {class:"dropbtn",href:'javascript:void(0)'}, 
						"#DataStory"
						),
					m("a", {class:"dropdown-content"}, 
						m("a", {href:'http://afd.countrydashboards.com/datastory/Initiative+Sahel.html', id:'Initiative_sahel'}, 
							"Initiative Sahel - construction"
							)
						)
					]
					),
				m("li", {class:"dropdown"},
					[
					m("a", {class:"dropbtn", href:'javascript:void(0)'}, 
						"Big Browser"
						),
					m("div", {class:"dropdown-content"},
						[
						m("a",{href:'http://afd.countrydashboards.com/WDI+browser.html',id:'WDI'}, 
							"World Bank WDI"
							),
						m("a", {href:'http://afd.countrydashboards.com/DHS+browser.html', id:'DHS'}, 
							"Demographic Health Surveys"
							),
						m("a",{href:'http://afd.countrydashboards.com/FAO+browser.html', id:'FAO'}, 
							"FAO crop prices"
							)
						]
						)
					]
					),
				m("li", {style: {float: "right"}}, 
					m("a",{href:'',id:'Data'}, 
						"#DataDriven wiki"
						)
					)
				]
				)
}
}


	//Map component
	var Map = {
		oncreate: function(vnode){
			// At the creation of component, we create the map
			var mymap = L.map("mapid", {
				center: [30.4277547, -9.5981072],
				zoom: 13,
				minZoom: 12
			});

			L.tileLayer('https://api.mapbox.com/styles/v1/etibdv/cj0kv2vnc003a2rt8m01gpf4h/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXRpYmR2IiwiYSI6ImNpejhvdWJmcjAwMW8yd28weTkzMnA1aDkifQ.i8UKq0M_sIN1qq8F6UAgFw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery © <a href="http://mapbox.com">Mapbox</a>',
				id: 'mapbox.streets'
			}).addTo(mymap);
		},

		view: function(){
			return (m("div",  {id:"mapid"}))
		}
	}


	//Wikipedia component
	var Wiki = {
		oninit: Data.wiki.fetch,

		view: function(vnode) {
			return Data.wiki.error ? [m(".error", Data.wiki.error)
			] : Data.wiki.conten ? [ 			
			m.trust(Data.wiki.conten)
			] : m("a","Loading Data from wikipedia")
		}
	}




	m.mount(document.getElementById("wikiintro"),Wiki);

	m.mount(document.getElementById("afdmenu"), Menuafd);

	m.mount(document.getElementById("leafletmap"), Map);


	</script>
</body>
<html>


